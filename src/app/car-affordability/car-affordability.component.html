<div class="prediction-page" [class.dark-mode]="themeService.isDarkMode()">
  <!-- Enhanced Shadow Decorations -->
  <div class="bg-decorations">
    <div class="shape shape-1"></div>
    <div class="shape shape-2"></div>
    <div class="shape shape-3"></div>
    <div class="shape shape-4"></div>
    <div class="shape shape-5"></div>
    <div class="shape shape-6"></div>
    <div class="shape shape-7"></div>
  </div>

  <!-- Road Container - Wide Shape with Home Page Colors -->
  <div class="highway-container">
    <svg class="highway-svg" viewBox="0 0 200 600" preserveAspectRatio="none">
      <defs>
        <filter id="roadShadowCar">
          <feDropShadow dx="0" dy="2" stdDeviation="3" flood-opacity="0.3"/>
        </filter>
      </defs>
      
      <!-- Layer 1: Sidewalks - Light gray (home page color) -->
      <path 
        d="M60,0 Q65,150 70,300 T80,600"
        fill="none" 
        stroke="#e8e8e8" 
        stroke-width="90" 
        stroke-linecap="round" 
        opacity="0.8"
        filter="url(#roadShadowCar)" />
      
      <!-- Layer 2: Curbs - Subtle definition (home page color) -->
      <path 
        d="M60,0 Q65,150 70,300 T80,600"
        fill="none" 
        stroke="#d0d0d0" 
        stroke-width="80" 
        stroke-linecap="round" />
      
      <!-- Layer 3: Main Road - Black (home page color) -->
      <path 
        d="M60,0 Q65,150 70,300 T80,600"
        fill="none" 
        stroke="#000000" 
        stroke-width="70" 
        stroke-linecap="round" />
      
      <!-- Road Markings - Brand red (home page color) -->
      <path 
        d="M60,0 Q65,150 70,300 T80,600"
        fill="none" 
        stroke="#c41e3a" 
        stroke-width="2.5" 
        stroke-dasharray="25 20" 
        class="center-line" />
    </svg>

    <!-- Animated Car with Speed Effect -->
    <div class="car-wrapper">
      <div class="car-glow"></div>
      <div class="speed-lines"></div>
      <img src="car.png" alt="Car" class="car-img" />
    </div>
  </div>

  <!-- Theme Toggle -->
  <button class="theme-toggle" (click)="toggleTheme()" [attr.aria-label]="themeService.isDarkMode() ? 'Switch to light mode' : 'Switch to dark mode'">
    <svg *ngIf="!themeService.isDarkMode()" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
    </svg>
    <svg *ngIf="themeService.isDarkMode()" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="5"/>
      <line x1="12" y1="1" x2="12" y2="3"/>
      <line x1="12" y1="21" x2="12" y2="23"/>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
      <line x1="1" y1="12" x2="3" y2="12"/>
      <line x1="21" y1="12" x2="23" y2="12"/>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
    </svg>
  </button>

  <!-- Back Button -->
  <button class="back-button" (click)="goBack()" aria-label="Go back to home">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
      <path d="M19 12H5M12 19l-7-7 7-7"/>
    </svg>
    Back
  </button>

  <!-- Main Content -->
  <div class="content-wrapper">
    <div class="page-header">
      <h1 class="page-title">Used Car Evaluation</h1>
      <p class="page-subtitle">Find out if you're getting a good deal</p>
    </div>

    <div class="form-container">
      <form (ngSubmit)="onSubmit()">
        <div class="form-grid">
          <!-- Car Model -->
          <div class="form-group">
            <label for="model" class="form-label">Car Model</label>
            <input 
              type="text" 
              id="model" 
              name="model"
              [(ngModel)]="formData.model"
              class="form-input"
              placeholder="e.g., Toyota Corolla, Dacia Logan"
              required
            />
          </div>

          <!-- Year -->
          <div class="form-group">
            <label for="year" class="form-label">Year</label>
            <input 
              type="number" 
              id="year" 
              name="year"
              [(ngModel)]="formData.year"
              class="form-input"
              placeholder="e.g., 2018"
              min="1990"
              max="2024"
              required
            />
          </div>

          <!-- Kilometers Driven -->
          <div class="form-group">
            <label for="km" class="form-label">Kilometers Driven</label>
            <input 
              type="number" 
              id="km" 
              name="km"
              [(ngModel)]="formData.km_driven"
              class="form-input"
              placeholder="e.g., 80000"
              min="0"
              required
            />
          </div>

          <!-- Fuel Type -->
          <div class="form-group">
            <label for="fuel" class="form-label">Fuel Type</label>
            <select 
              id="fuel" 
              name="fuel"
              [(ngModel)]="formData.fuel"
              class="form-select"
              required
            >
              <option value="">Select fuel type</option>
              <option *ngFor="let fuel of fuelTypes" [value]="fuel">{{ fuel }}</option>
            </select>
          </div>

          <!-- Condition -->
          <div class="form-group">
            <label for="condition" class="form-label">Condition</label>
            <select 
              id="condition" 
              name="condition"
              [(ngModel)]="formData.condition"
              class="form-select"
              required
            >
              <option value="">Select condition</option>
              <option *ngFor="let cond of conditionLevels" [value]="cond">{{ cond }}</option>
            </select>
          </div>

          <!-- First Owner -->
          <div class="form-group">
            <label for="owner" class="form-label">First Owner</label>
            <select 
              id="owner" 
              name="owner"
              [(ngModel)]="formData.first_owner"
              class="form-select"
              required
            >
              <option value="">Select</option>
              <option [value]="1">Yes</option>
              <option [value]="0">No</option>
            </select>
          </div>

          <!-- Fiscal Power -->
          <div class="form-group">
            <label for="power" class="form-label">Fiscal Power (CV)</label>
            <input 
              type="number" 
              id="power" 
              name="power"
              [(ngModel)]="formData.fiscal_power"
              class="form-input"
              placeholder="e.g., 8"
              min="1"
              max="30"
              required
            />
          </div>

          <!-- Price -->
          <div class="form-group">
            <label for="price" class="form-label">Asking Price (DH)</label>
            <input 
              type="number" 
              id="price" 
              name="price"
              [(ngModel)]="formData.price"
              class="form-input"
              placeholder="e.g., 85000"
              min="0"
              required
            />
          </div>
        </div>

        <!-- Error Message -->
        <div class="error-message" *ngIf="errorMessage">
          <strong>⚠</strong> {{ errorMessage }}
        </div>

        <!-- Submit Button -->
        <button 
          type="submit" 
          class="submit-button"
          [disabled]="isLoading"
        >
          <span *ngIf="!isLoading">Check Deal</span>
          <span *ngIf="isLoading" class="loading-spinner">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10" opacity="0.25"/>
              <path d="M12 2a10 10 0 0 1 10 10" stroke-linecap="round">
                <animateTransform attributeName="transform" type="rotate" from="0 12 12" to="360 12 12" dur="1s" repeatCount="indefinite"/>
              </path>
            </svg>
            Analyzing...
          </span>
        </button>
      </form>
    </div>

    <!-- Result Popup Modal -->
    <div class="modal-overlay" *ngIf="prediction !== null && prediction !== undefined" (click)="closeResult()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <button class="modal-close" (click)="closeResult()" aria-label="Close">×</button>
        <div class="modal-header">
          <h2 class="modal-title">Used Car Evaluation Result</h2>
        </div>
        <div class="modal-body">
          <div class="result-badge-container">
            <div class="result-status-badge" [class.good-deal]="prediction.is_good_deal" [class.bad-deal]="!prediction.is_good_deal">
              <span class="result-icon">{{ prediction.is_good_deal ? '✓' : '✗' }}</span>
              <span class="result-text">{{ prediction.is_good_deal ? 'Good Deal' : 'Not a Good Deal' }}</span>
            </div>
          </div>
          <p class="result-message">
            {{ prediction.is_good_deal ? 
              'Based on the car\'s specifications and market data, this appears to be a good value for the asking price.' : 
              'Based on the car\'s specifications and market data, this may be overpriced. Consider negotiating or looking at other options.' 
            }}
          </p>
        </div>
        <div class="modal-footer">
          <button class="modal-button" (click)="closeResult()">Close</button>
        </div>
      </div>
    </div>

    <!-- Model Description Footer -->
    <div class="model-info">
      <h3 class="model-info-title">About This Model</h3>
      <p class="model-info-text">
        Our used car evaluation model uses machine learning trained on thousands of car listings. 
        The model analyzes the car's make, year, mileage, fuel type, condition, ownership history, and fiscal power 
        to determine if the asking price represents good value compared to similar vehicles in the market.
      </p>
    </div>
  </div>
</div>
