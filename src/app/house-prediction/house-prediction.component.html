<div class="prediction-page" [class.dark-mode]="themeService.isDarkMode()">
  <!-- Enhanced Shadow Decorations -->
  <div class="bg-decorations">
    <div class="shape shape-1"></div>
    <div class="shape shape-2"></div>
    <div class="shape shape-3"></div>
    <div class="shape shape-4"></div>
    <div class="shape shape-5"></div>
    <div class="shape shape-6"></div>
    <div class="shape shape-7"></div>
  </div>

  <!-- Road Container - Wide Shape with Home Page Colors -->
  <div class="highway-container">
    <svg class="highway-svg" viewBox="0 0 200 600" preserveAspectRatio="none">
      <defs>
        <filter id="roadShadowHouse">
          <feDropShadow dx="0" dy="2" stdDeviation="3" flood-opacity="0.3"/>
        </filter>
      </defs>
      
      <!-- Layer 1: Sidewalks - Light gray (home page color) -->
      <path 
        d="M60,0 Q65,150 70,300 T80,600"
        fill="none" 
        stroke="#e8e8e8" 
        stroke-width="90" 
        stroke-linecap="round" 
        opacity="0.8"
        filter="url(#roadShadowHouse)" />
      
      <!-- Layer 2: Curbs - Subtle definition (home page color) -->
      <path 
        d="M60,0 Q65,150 70,300 T80,600"
        fill="none" 
        stroke="#d0d0d0" 
        stroke-width="80" 
        stroke-linecap="round" />
      
      <!-- Layer 3: Main Road - Black (home page color) -->
      <path 
        d="M60,0 Q65,150 70,300 T80,600"
        fill="none" 
        stroke="#000000" 
        stroke-width="70" 
        stroke-linecap="round" />
      
      <!-- Road Markings - Brand red (home page color) -->
      <path 
        d="M60,0 Q65,150 70,300 T80,600"
        fill="none" 
        stroke="#c41e3a" 
        stroke-width="2.5" 
        stroke-dasharray="25 20" 
        class="center-line" />
    </svg>

    <!-- Animated Home -->
    <div class="character-wrapper">
      <div class="character-glow"></div>
      <img src="home.png" alt="Home" class="character-img" />
    </div>
  </div>

  <!-- Theme Toggle -->
  <button class="theme-toggle" (click)="toggleTheme()" [attr.aria-label]="themeService.isDarkMode() ? 'Switch to light mode' : 'Switch to dark mode'">
    <svg *ngIf="!themeService.isDarkMode()" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
    </svg>
    <svg *ngIf="themeService.isDarkMode()" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="5"/>
      <line x1="12" y1="1" x2="12" y2="3"/>
      <line x1="12" y1="21" x2="12" y2="23"/>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
      <line x1="1" y1="12" x2="3" y2="12"/>
      <line x1="21" y1="12" x2="23" y2="12"/>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
    </svg>
  </button>

  <!-- Back Button -->
  <button class="back-button" (click)="goBack()" aria-label="Go back to home">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
      <path d="M19 12H5M12 19l-7-7 7-7"/>
    </svg>
    Back
  </button>

  <!-- Main Content -->
  <div class="content-wrapper">
    <div class="page-header">
      <h1 class="page-title">Morocco Property Price Prediction</h1>
      <p class="page-subtitle">Estimate property value based on market data</p>
    </div>

    <div class="form-container">
      <form (ngSubmit)="onSubmit()">
        <div class="form-grid">
          <!-- Property Type -->
          <div class="form-group">
            <label for="property_type" class="form-label">Property Type</label>
            <select 
              id="property_type" 
              name="property_type"
              [(ngModel)]="formData.property_type"
              class="form-select"
              required
            >
              <option value="" disabled selected>Select property type</option>
              <option *ngFor="let type of propertyTypes" [value]="type">{{ type }}</option>
            </select>
          </div>

          <!-- Transaction Type -->
          <div class="form-group">
            <label for="transaction" class="form-label">Transaction</label>
            <select 
              id="transaction" 
              name="transaction"
              [(ngModel)]="formData.transaction"
              class="form-select"
              required
            >
              <option value="" disabled selected>Select transaction</option>
              <option *ngFor="let trans of transactionTypes" [value]="trans">{{ trans }}</option>
            </select>
          </div>

          <!-- Surface -->
          <div class="form-group">
            <label for="surface" class="form-label">Surface (m²)</label>
            <input 
              type="number" 
              id="surface" 
              name="surface"
              [(ngModel)]="formData.surface"
              class="form-input"
              placeholder="25 - 598 m²"
              min="25"
              max="598"
              required
            />
          </div>

          <!-- Rooms -->
          <div class="form-group">
            <label for="rooms" class="form-label">Rooms</label>
            <input 
              type="number" 
              id="rooms" 
              name="rooms"
              [(ngModel)]="formData.rooms"
              class="form-input"
              placeholder="1 - 10"
              min="1"
              max="10"
              required
            />
          </div>

          <!-- Bathrooms -->
          <div class="form-group">
            <label for="bathrooms" class="form-label">Bathrooms</label>
            <input 
              type="number" 
              id="bathrooms" 
              name="bathrooms"
              [(ngModel)]="formData.bathrooms"
              class="form-input"
              placeholder="1 - 4"
              min="1"
              max="4"
              required
            />
          </div>

          <!-- Floor -->
          <div class="form-group">
            <label for="floor" class="form-label">Floor</label>
            <input 
              type="number" 
              id="floor" 
              name="floor"
              [(ngModel)]="formData.floor"
              class="form-input"
              placeholder="0 - 12"
              min="0"
              max="12"
              required
            />
          </div>

          <!-- City -->
          <div class="form-group">
            <label for="city" class="form-label">City</label>
            <select 
              id="city" 
              name="city"
              [(ngModel)]="formData.city"
              class="form-select"
              required
            >
              <option value="" disabled selected>Select city</option>
              <option *ngFor="let city of cities" [value]="city">{{ city }}</option>
            </select>
          </div>

          <!-- Neighborhood -->
          <div class="form-group">
            <label for="neighborhood" class="form-label">Neighborhood</label>
            <input 
              type="text" 
              id="neighborhood" 
              name="neighborhood"
              [(ngModel)]="formData.neighborhood"
              class="form-input"
              placeholder="e.g., Maarif, Agdal"
              required
            />
          </div>

          <!-- Condition -->
          <div class="form-group">
            <label for="condition" class="form-label">Condition</label>
            <select 
              id="condition" 
              name="condition"
              [(ngModel)]="formData.condition"
              class="form-select"
              required
            >
              <option value="" disabled selected>Select condition</option>
              <option *ngFor="let cond of conditions" [value]="cond">{{ cond }}</option>
            </select>
          </div>

          <!-- Age -->
          <div class="form-group">
            <label for="age" class="form-label">Age (years)</label>
            <input 
              type="number" 
              id="age" 
              name="age"
              [(ngModel)]="formData.age"
              class="form-input"
              placeholder="0 - 40 years"
              min="0"
              max="40"
              required
            />
          </div>
        </div>

        <!-- Error Message -->
        <div class="error-message" *ngIf="errorMessage">
          <strong>⚠</strong> {{ errorMessage }}
        </div>

        <!-- Submit Button -->
        <button 
          type="submit" 
          class="submit-button"
          [disabled]="isLoading"
        >
          <span *ngIf="!isLoading">Estimate Price</span>
          <span *ngIf="isLoading" class="loading-spinner">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10" opacity="0.25"/>
              <path d="M12 2a10 10 0 0 1 10 10" stroke-linecap="round">
                <animateTransform attributeName="transform" type="rotate" from="0 12 12" to="360 12 12" dur="1s" repeatCount="indefinite"/>
              </path>
            </svg>
            Estimating...
          </span>
        </button>
      </form>
    </div>

    <!-- Result Popup Modal -->
    <div class="modal-overlay" *ngIf="prediction !== null && prediction !== undefined" (click)="closeResult()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <button class="modal-close" (click)="closeResult()" aria-label="Close">×</button>
        <div class="modal-header">
          <h2>Estimated House Price</h2>
        </div>
        <div class="modal-body">
          <div class="result-amount">{{ prediction | number:'1.0-0' }} DH</div>
          <p class="result-note">Based on current market analysis</p>
        </div>
        <div class="modal-footer">
          <button class="modal-button" (click)="closeResult()">Close</button>
        </div>
      </div>
    </div>

    <!-- Model Description Footer -->
    <div class="model-info">
      <h3 class="model-info-title">About This Model</h3>
      <p class="model-info-text">
        Our house price prediction model utilizes sophisticated machine learning techniques trained on comprehensive 
        real estate datasets. By analyzing property features such as location, size, condition, and amenities, 
        the model provides accurate price estimates to help you plan your home purchase with confidence and clarity.
      </p>
    </div>
  </div>
</div>
